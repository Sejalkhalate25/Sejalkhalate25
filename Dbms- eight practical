EXPERIMENT – 8 TRIGGERS
Aim: Creation of insert trigger, delete trigger and update trigger.

MySQL>CREATE TABLE BUS(BUSNO VARCHAR(10) NOT NULL, SOURCE VARCHAR(10), DESTINATION VARCHAR(10), CAPACITY INT(2), PRIMARY KEY(BUSNO));
MySQL>INSERT INTO BUS VALUES('AP123','HYD','CHENNAI','40');



CREATE TABLE BUS_AUDIT1(ID INT NOT NULL AUTO_INCREMENT, SOURCE VARCHAR(10) NOT NULL, CHANGEDON DATETIME DEFAULT NULL, ACTION VARCHAR(10) DEFAULT NULL, PRIMARY KEY(ID));



 




CREATE TRIGGER BEFORE_BUS_UPDATE BEFORE UPDATE ON BUS FOR EACH ROW BEGIN
INSERT INTO BUS_AUDIT1

SET action='update', source=OLD.source, changedon=NOW(); END$$





UPDATE :



MySQL>UPDATE BUS SET SOURCE='KERALA' WHERE BUSNO='AP123'$$


 



SNo	Source	Changedon	Action
1	Banglore	2014:03:23 12:51:00	Insert
2	Kerela	2014:03:25:12:56:00	Update
3	Mumbai	2014:04:26:12:59:02	Delete


INSERT:

CREATE TRIGGER BEFORE_BUS_INSERT BEFORE INSERT ON BUS FOR EACH ROW BEGIN
INSERT INTO BUS_AUDIT1

SET action='Insert', source=NEW.source, changedon=NOW(); END$$ MYSQL>INSERT INTO BUS VALUES('AP789','VIZAG','HYDERABAD',30)$$



SNo	Source	Changedon	Action
1	Banglore	2014:03:23 12:51:00	Insert
2	Kerela	2014:03:25:12:56:00	Update
3	Mumbai	2014:04:26:12:59:02	Delete
 




CREATE TRIGGER BEFORE_BUS_DELETE BEFORE DELETE ON BUS FOR EACH ROW BEGIN
DELETE FROM BUS_AUDIT1



SET action='Insert', source=NEW.source, changedon=NOW(); END$$ DELETE FROM BUS WHERE SOURCE=’HYDERABAD’$$


SNo	Source	Changedon	Action
1	Banglore	2014:03:23 12:51:00	Insert
2	Kerela	2014:03:25:12:56:00	Update
3	Mumbai	2014:04:26:12:59:02	Delete


Examples



CREATE TRIGGER updcheck1 BEFORE UPDATE ON passengerticket FOR EACH ROW BEGIN
IF NEW.TicketNO > 60 THEN

SET New.TicketNo = New.TicketNo; ELSE SET New.TicketNo = 0; END IF;
END;

 




 



 


